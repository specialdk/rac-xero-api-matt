<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAC Mining - CEO Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: #f5f5f5;
        padding: 20px;
      }

      .header {
        background: white;
        padding: 15px 25px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        font-size: 24px;
        color: #2c3e50;
      }

      .company-selector {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .company-selector select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .period-selector {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        background: white;
      }

      /* Dashboard Grid */
      .dashboard {
        display: grid;
        gap: 20px;
      }

      /* Top Row - 3 columns */
      .top-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
      }

      /* Middle Row - 4 columns */
      .middle-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
      }

      /* Bottom Row - 2 columns (one dotted placeholder) */
      .bottom-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .panel {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .panel h2 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #2c3e50;
      }

      /* P&L Section - Special Layout */
      .pl-section {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 15px;
      }

      .balance-mini {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
      }

      .balance-mini h3 {
        font-size: 13px;
        margin-bottom: 10px;
        color: #666;
      }

      .balance-row {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        font-size: 12px;
        border-bottom: 1px solid #eee;
      }

      .budget-comparison {
        background: #fffbeb;
        padding: 15px;
        border-radius: 4px;
      }

      .budget-comparison h3 {
        font-size: 14px;
        margin-bottom: 12px;
        color: #333;
      }

      .budget-grid {
        display: grid;
        grid-template-columns: auto 1fr 1fr 1fr;
        gap: 8px;
        align-items: center;
        font-size: 13px;
      }

      .budget-label {
        font-weight: 600;
        color: #555;
      }

      .budget-header {
        font-weight: 600;
        color: #666;
        font-size: 12px;
        text-align: right;
      }

      .budget-value {
        text-align: right;
        padding: 4px 8px;
        background: white;
        border-radius: 3px;
      }

      .cogs-section {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #e0e0e0;
      }

      .cogs-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 14px;
      }

      /* Inventory Table */
      .inventory-table,
      .orders-table {
        width: 100%;
        font-size: 12px;
        border-collapse: collapse;
      }

      .inventory-table th,
      .inventory-table td,
      .orders-table th,
      .orders-table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .inventory-table th,
      .orders-table th {
        font-weight: 600;
        color: #666;
        font-size: 11px;
        text-transform: uppercase;
      }

      .forecast-value {
        color: #3b82f6;
        font-weight: 500;
      }

      .placeholder-note {
        font-size: 11px;
        color: #999;
        font-style: italic;
        margin-top: 10px;
      }

      /* Balance Section */
      .balance-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #eee;
        font-size: 14px;
      }

      .balance-item:last-child {
        border-bottom: none;
      }

      .balance-chart {
        margin-top: 15px;
        background: #f8f9fa;
        height: 150px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        font-size: 12px;
      }

      /* Top Customers */
      .customer-list {
        list-style: none;
      }

      .customer-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
        font-size: 13px;
      }

      .customer-name {
        color: #333;
      }

      .customer-amount {
        font-weight: 600;
        color: #27ae60;
      }

      .period-label {
        font-size: 11px;
        color: #666;
        margin-bottom: 12px;
      }

      .api-note {
        font-size: 11px;
        color: #999;
        font-style: italic;
        margin-top: 8px;
      }

      /* Aged Debtors */
      .aged-legend {
        display: flex;
        gap: 15px;
        margin-bottom: 12px;
        font-size: 11px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 2px;
      }

      .aged-bar {
        display: flex;
        height: 60px;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 15px;
      }

      .aged-segment {
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 13px;
        font-weight: 600;
      }

      .aged-30 {
        background: #94a3b8;
      }
      .aged-60 {
        background: #fb923c;
      }
      .aged-90 {
        background: #f97316;
      }
      .aged-120 {
        background: #ef4444;
      }

      .aged-summary {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-top: 1px solid #eee;
        font-size: 13px;
      }

      /* Cash Position */
      .cash-current {
        font-size: 24px;
        font-weight: 700;
        color: #27ae60;
        margin-bottom: 15px;
      }

      .cash-chart {
        margin-top: 15px;
        background: #f8f9fa;
        height: 180px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        font-size: 12px;
      }

      /* Ratios */
      .ratio-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
        font-size: 13px;
      }

      .ratio-item:last-child {
        border-bottom: none;
      }

      .ratio-value {
        font-weight: 600;
        color: #3b82f6;
      }

      /* Future Panel */
      .future-panel {
        border: 2px dashed #cbd5e1;
        background: #f8fafc;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 300px;
      }

      .future-panel-icon {
        font-size: 48px;
        color: #cbd5e1;
        margin-bottom: 10px;
      }

      .future-panel-text {
        color: #94a3b8;
        font-size: 14px;
      }

      /* Loading State */
      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }

      .error {
        background: #fee;
        border: 1px solid #fcc;
        padding: 15px;
        border-radius: 4px;
        color: #c00;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <h1>üèîÔ∏è Mining - CEO Dashboard</h1>
      <div class="company-selector">
        <select id="periodSelector" class="period-selector">
          <option value="Q1">Q1 FY25/26 (Jul-Sep)</option>
          <option value="Q2" selected>Q2 FY25/26 (Oct-Dec)</option>
          <option value="Q3">Q3 FY25/26 (Jan-Mar)</option>
          <option value="Q4">Q4 FY25/26 (Apr-Jun)</option>
        </select>
        <button
          onclick="loadDashboard()"
          style="
            padding: 8px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
          "
        >
          LOAD
        </button>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard">
      <!-- TOP ROW -->
      <div class="top-row">
        <!-- P&L Section -->
        <div class="panel">
          <h2>P&L Section</h2>
          <div class="pl-section">
            <!-- Left: Balance Sheet Mini -->
            <div class="balance-mini">
              <h3>Balance Sheet</h3>
              <div class="balance-row">
                <span>Current Assets</span>
                <span id="bs-current-assets">-</span>
              </div>
              <div class="balance-row">
                <span>Non Current Assets</span>
                <span id="bs-non-current-assets">-</span>
              </div>
              <div class="balance-row">
                <span>Current Liabilities</span>
                <span id="bs-current-liabilities">-</span>
              </div>
              <div class="balance-row">
                <span>Non Current Liabilities</span>
                <span id="bs-non-current-liabilities">-</span>
              </div>
            </div>

            <!-- Right: Actual v Budget -->
            <div class="budget-comparison">
              <h3>Actual v Budget</h3>
              <div class="budget-grid">
                <div></div>
                <div class="budget-header">Budget</div>
                <div class="budget-header">Actual</div>
                <div class="budget-header">Variance</div>

                <div class="budget-label">Revenue</div>
                <div class="budget-value" id="revenue-budget">-</div>
                <div class="budget-value" id="revenue-actual">-</div>
                <div class="budget-value" id="revenue-variance">-</div>

                <div class="budget-label">Expenses</div>
                <div class="budget-value" id="expenses-budget">-</div>
                <div class="budget-value" id="expenses-actual">-</div>
                <div class="budget-value" id="expenses-variance">-</div>
              </div>
            </div>
          </div>

          <!-- COGS & Overheads -->
          <div class="cogs-section">
            <div class="cogs-row">
              <strong>COGS</strong>
              <span id="cogs-value">-</span>
            </div>
            <div class="cogs-row">
              <strong>Overheads</strong>
              <span id="overheads-value">-</span>
            </div>
          </div>
        </div>

        <!-- Inventory & Forecasting -->
        <div class="panel">
          <h2>Inventory & Forecasting</h2>
          <table class="inventory-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Cur.STK</th>
                <th>Q2 Plan</th>
                <th>Q3/4 Plan</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1. Sand</td>
                <td>250</td>
                <td>200</td>
                <td class="forecast-value">800</td>
              </tr>
              <tr>
                <td>2. 20mm</td>
                <td>580</td>
                <td>200</td>
                <td class="forecast-value">200</td>
              </tr>
              <tr>
                <td>3. 40mm</td>
                <td>150</td>
                <td>0</td>
                <td class="forecast-value">500</td>
              </tr>
              <tr>
                <td>4. 80mm</td>
                <td>50</td>
                <td>50</td>
                <td class="forecast-value">300</td>
              </tr>
              <tr>
                <td>5. RBase</td>
                <td>0</td>
                <td>100</td>
                <td class="forecast-value">100</td>
              </tr>
              <tr>
                <td>6. XYZ</td>
                <td>0</td>
                <td>150</td>
                <td class="forecast-value">300</td>
              </tr>
            </tbody>
          </table>
          <div class="placeholder-note">
            Note: Inventory data requires manual input or separate system
            integration
          </div>
        </div>

        <!-- Open Orders -->
        <div class="panel">
          <h2>Open Orders</h2>
          <table class="orders-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Q1</th>
                <th>Q2</th>
                <th>Q3</th>
                <th>Q4</th>
              </tr>
            </thead>
            <tbody id="open-orders-table">
              <tr>
                <td colspan="5" class="loading">Loading orders...</td>
              </tr>
            </tbody>
          </table>
          <div class="placeholder-note" id="orders-note">
            Note: Order pipeline data requires CRM or order management
            integration
          </div>
        </div>
      </div>

      <!-- MIDDLE ROW -->
      <div class="middle-row">
        <!-- Balance -->
        <div class="panel">
          <h2>Balance</h2>
          <div class="balance-item">
            <span>Total Assets</span>
            <strong id="total-assets">-</strong>
          </div>
          <div class="balance-item">
            <span>Total Liabilities</span>
            <strong id="total-liabilities">-</strong>
          </div>
          <div class="balance-item">
            <span>Total Equity</span>
            <strong id="total-equity">-</strong>
          </div>
          <div class="balance-chart">
            Visual balance strength chart placeholder (gauge or bar comparison)
          </div>
        </div>

        <!-- Top X Customers -->
        <div class="panel">
          <h2>Top X Customers</h2>
          <div class="period-label" id="customers-period">FY25/26</div>
          <ul class="customer-list" id="customer-list">
            <li class="loading">Loading customers...</li>
          </ul>
          <div class="api-note">
            Note: Will populate from Aged Receivables API
          </div>
        </div>

        <!-- Aged Debtors -->
        <div class="panel">
          <h2>Aged Debtors</h2>
          <div class="aged-legend">
            <div class="legend-item">
              <div class="legend-color aged-30"></div>
              <span>30 Days</span>
            </div>
            <div class="legend-item">
              <div class="legend-color aged-60"></div>
              <span>60 Days</span>
            </div>
            <div class="legend-item">
              <div class="legend-color aged-90"></div>
              <span>90 Days</span>
            </div>
            <div class="legend-item">
              <div class="legend-color aged-120"></div>
              <span>120+ Days</span>
            </div>
          </div>
          <div class="aged-bar" id="aged-bar">
            <div class="aged-segment aged-30" style="width: 30%">30%</div>
            <div class="aged-segment aged-60" style="width: 20%">20%</div>
            <div class="aged-segment aged-90" style="width: 20%">20%</div>
            <div class="aged-segment aged-120" style="width: 30%">30%</div>
          </div>
          <div class="aged-summary">
            <span>Total Outstanding</span>
            <strong id="aged-total">-</strong>
          </div>
          <div class="aged-summary">
            <span>Critical (90+ days)</span>
            <strong id="aged-critical">-</strong>
          </div>
        </div>

        <!-- Cash Position -->
        <div class="panel">
          <h2>Cash Position</h2>
          <div class="cash-current" id="current-cash">-</div>
          <div class="cash-chart">
            Cash Trend Chart (Jul-Jun)&lt;br&gt;Line chart with vertical red
            line at current month
          </div>
          <div class="api-note">
            Note: Chart requires historical cash position data
          </div>
        </div>
      </div>

      <!-- BOTTOM ROW -->
      <div class="bottom-row">
        <!-- Financial Ratios -->
        <div class="panel">
          <h2>Financial Ratios</h2>
          <div class="ratio-item">
            <span>Current Ratio</span>
            <span class="ratio-value" id="ratio-current">-</span>
          </div>
          <div class="ratio-item">
            <span>Gross Margin %</span>
            <span class="ratio-value" id="ratio-gross-margin">-</span>
          </div>
          <div class="ratio-item">
            <span>Net Profit Margin %</span>
            <span class="ratio-value" id="ratio-net-margin">-</span>
          </div>
          <div class="ratio-item">
            <span>Debt to Equity</span>
            <span class="ratio-value" id="ratio-debt-equity">-</span>
          </div>
          <div class="ratio-item">
            <span>Return on Assets %</span>
            <span class="ratio-value" id="ratio-roa">-</span>
          </div>
          <div class="ratio-item">
            <span>Debtor Days</span>
            <span class="ratio-value" id="ratio-debtor-days">-</span>
          </div>
        </div>

        <!-- Future Panel -->
        <div class="panel future-panel">
          <div class="future-panel-icon">+</div>
          <div class="future-panel-text">Optional future visualization</div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "https://rac-xero-api-matt-production.up.railway.app";
      const MINING_ORG = "Mining";

      async function loadDashboard() {
        const period = document.getElementById("periodSelector").value;
        console.log("Loading dashboard for period:", period);

        try {
          await Promise.all([
            loadTrialBalance(),
            loadProfitLoss(period),
            loadBudget(period),
            loadCashPosition(),
            loadAgedReceivables(),
            loadFinancialRatios(),
            loadTopCustomers(),
          ]);
        } catch (error) {
          console.error("Error loading dashboard:", error);
          alert("Error loading dashboard data. Check console for details.");
        }
      }

      async function loadTrialBalance() {
        try {
          const response = await fetch(`${API_BASE}/api/trial-balance`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ organizationName: MINING_ORG }),
          });

          const data = await response.json();
          console.log("Trial Balance:", data);

          // Update Balance section
          document.getElementById("total-assets").textContent =
            "$" +
            (data.trialBalance?.totals?.totalAssets || 0).toLocaleString();
          document.getElementById("total-liabilities").textContent =
            "$" +
            (data.trialBalance?.totals?.totalLiabilities || 0).toLocaleString();
          document.getElementById("total-equity").textContent =
            "$" +
            (data.trialBalance?.totals?.totalEquity || 0).toLocaleString();

          // Update P&L Balance Sheet mini section
          const assets = data.trialBalance?.assets || [];
          const liabilities = data.trialBalance?.liabilities || [];

          const currentAssets = assets
            .filter((a) => a.name.includes("Current"))
            .reduce((sum, a) => sum + a.balance, 0);
          const nonCurrentAssets = assets
            .filter((a) => !a.name.includes("Current"))
            .reduce((sum, a) => sum + a.balance, 0);
          const currentLiab = liabilities
            .filter((l) => l.name.includes("Current"))
            .reduce((sum, l) => sum + l.balance, 0);
          const nonCurrentLiab = liabilities
            .filter((l) => !l.name.includes("Current"))
            .reduce((sum, l) => sum + l.balance, 0);

          document.getElementById("bs-current-assets").textContent =
            "$" + currentAssets.toLocaleString();
          document.getElementById("bs-non-current-assets").textContent =
            "$" + nonCurrentAssets.toLocaleString();
          document.getElementById("bs-current-liabilities").textContent =
            "$" + Math.abs(currentLiab).toLocaleString();
          document.getElementById("bs-non-current-liabilities").textContent =
            "$" + Math.abs(nonCurrentLiab).toLocaleString();
        } catch (error) {
          console.error("Error loading trial balance:", error);
        }
      }

      async function loadProfitLoss(period) {
        try {
          const periodMonths = 3; // Quarter
          const response = await fetch(`${API_BASE}/api/profit-loss-summary`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              organizationName: MINING_ORG,
              periodMonths: periodMonths,
            }),
          });

          const data = await response.json();
          console.log("P&L:", data);

          const revenue = data.summary?.totalRevenue || 0;
          const expenses = data.summary?.totalExpenses || 0;

          document.getElementById("revenue-actual").textContent =
            "$" + revenue.toLocaleString();
          document.getElementById("expenses-actual").textContent =
            "$" + expenses.toLocaleString();

          // COGS and Overheads - simplified for now
          document.getElementById("cogs-value").textContent =
            "$" + Math.round(expenses * 0.6).toLocaleString();
          document.getElementById("overheads-value").textContent =
            "$" + Math.round(expenses * 0.4).toLocaleString();
        } catch (error) {
          console.error("Error loading P&L:", error);
        }
      }

      async function loadBudget(period) {
        try {
          const quarters = { Q1: "Q1", Q2: "Q2", Q3: "Q3", Q4: "Q4" };
          const response = await fetch(`${API_BASE}/api/budget-summary`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              organizationName: MINING_ORG,
              quarter: quarters[period] || "Q2",
            }),
          });

          const data = await response.json();
          console.log("Budget:", data);

          // Parse budget from report structure
          const budget = parseBudgetFromReport(data.report);

          document.getElementById("revenue-budget").textContent =
            "$" + budget.revenue.toLocaleString();
          document.getElementById("expenses-budget").textContent =
            "$" + budget.expenses.toLocaleString();

          // Calculate variance
          const revenueActual =
            parseFloat(
              document
                .getElementById("revenue-actual")
                .textContent.replace(/[$,]/g, "")
            ) || 0;
          const expensesActual =
            parseFloat(
              document
                .getElementById("expenses-actual")
                .textContent.replace(/[$,]/g, "")
            ) || 0;

          const revenueVar = revenueActual - budget.revenue;
          const expensesVar = expensesActual - budget.expenses;

          document.getElementById("revenue-variance").textContent =
            (revenueVar >= 0 ? "+" : "") + "$" + revenueVar.toLocaleString();
          document.getElementById("expenses-variance").textContent =
            (expensesVar >= 0 ? "+" : "") + "$" + expensesVar.toLocaleString();
        } catch (error) {
          console.error("Error loading budget:", error);
          document.getElementById("revenue-budget").textContent = "-";
          document.getElementById("expenses-budget").textContent = "-";
        }
      }

      function parseBudgetFromReport(report) {
        let revenue = 0;
        let expenses = 0;

        if (!report || !report.rows) return { revenue: 0, expenses: 0 };

        for (const section of report.rows) {
          if (section.rowType === "Section" && section.title) {
            const title = section.title.toLowerCase();

            if (title.includes("income")) {
              const totalRow = section.rows?.find(
                (r) =>
                  r.rowType === "SummaryRow" &&
                  r.cells?.[0]?.value?.includes("Total")
              );
              if (totalRow && totalRow.cells) {
                // Sum columns 1,2,3 (the quarter months)
                revenue =
                  (parseFloat(totalRow.cells[1]?.value) || 0) +
                  (parseFloat(totalRow.cells[2]?.value) || 0) +
                  (parseFloat(totalRow.cells[3]?.value) || 0);
              }
            } else if (title.includes("expense")) {
              const totalRow = section.rows?.find(
                (r) =>
                  r.rowType === "SummaryRow" &&
                  r.cells?.[0]?.value?.includes("Total")
              );
              if (totalRow && totalRow.cells) {
                expenses =
                  (parseFloat(totalRow.cells[1]?.value) || 0) +
                  (parseFloat(totalRow.cells[2]?.value) || 0) +
                  (parseFloat(totalRow.cells[3]?.value) || 0);
              }
            }
          }
        }

        return { revenue, expenses };
      }

      async function loadCashPosition() {
        try {
          const response = await fetch(`${API_BASE}/api/cash-position`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ organizationName: MINING_ORG }),
          });

          const data = await response.json();
          console.log("Cash:", data);

          const totalCash = data.totalCash || 0;
          document.getElementById("current-cash").textContent =
            "$" + totalCash.toLocaleString();
        } catch (error) {
          console.error("Error loading cash position:", error);
        }
      }

      async function loadAgedReceivables() {
        try {
          const response = await fetch(`${API_BASE}/api/aged-receivables`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ organizationName: MINING_ORG }),
          });

          const data = await response.json();
          console.log("Aged Receivables:", data);

          // Parse aged data and update chart
          // This is a simplified version - actual implementation would parse the API response
          const total = data.totalOutstanding || 0;
          document.getElementById("aged-total").textContent =
            "$" + total.toLocaleString();
          document.getElementById("aged-critical").textContent =
            "$" + Math.round(total * 0.3).toLocaleString();
        } catch (error) {
          console.error("Error loading aged receivables:", error);
        }
      }

      async function loadFinancialRatios() {
        try {
          const response = await fetch(`${API_BASE}/api/financial-ratios`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ organizationName: MINING_ORG }),
          });

          const data = await response.json();
          console.log("Ratios:", data);

          document.getElementById("ratio-current").textContent = (
            data.currentRatio || 0
          ).toFixed(2);
          document.getElementById("ratio-gross-margin").textContent =
            (data.grossMargin || 0).toFixed(1) + "%";
          document.getElementById("ratio-net-margin").textContent =
            (data.netProfitMargin || 0).toFixed(1) + "%";
          document.getElementById("ratio-debt-equity").textContent = (
            data.debtToEquity || 0
          ).toFixed(2);
          document.getElementById("ratio-roa").textContent =
            (data.returnOnAssets || 0).toFixed(1) + "%";
          document.getElementById("ratio-debtor-days").textContent = Math.round(
            data.debtorDays || 0
          );
        } catch (error) {
          console.error("Error loading financial ratios:", error);
        }
      }

      async function loadTopCustomers() {
        try {
          // Use aged receivables to get top customers
          const response = await fetch(`${API_BASE}/api/aged-receivables`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ organizationName: MINING_ORG }),
          });

          const data = await response.json();
          console.log("Top Customers from Aged Receivables:", data);

          // Parse and display top 5 customers
          // This is a placeholder - actual implementation would parse the API response structure
          const customerList = document.getElementById("customer-list");
          customerList.innerHTML = `
          <li class="customer-item">
            <span class="customer-name">1. Customer A</span>
            <span class="customer-amount">$250,182</span>
          </li>
          <li class="customer-item">
            <span class="customer-name">2. Customer B</span>
            <span class="customer-amount">$133,156</span>
          </li>
          <li class="customer-item">
            <span class="customer-name">3. Customer Z</span>
            <span class="customer-amount">$87,405</span>
          </li>
          <li class="customer-item">
            <span class="customer-name">4. Customer M</span>
            <span class="customer-amount">$81,002</span>
          </li>
          <li class="customer-item">
            <span class="customer-name">5. Customer E</span>
            <span class="customer-amount">$66,983</span>
          </li>
        `;
        } catch (error) {
          console.error("Error loading top customers:", error);
          document.getElementById("customer-list").innerHTML =
            '<li class="error">Error loading customers</li>';
        }
      }

      //test 123
      // Auto-load on page load
      window.addEventListener("load", () => {
        loadDashboard();
      });
    </script>
  </body>
</html>
